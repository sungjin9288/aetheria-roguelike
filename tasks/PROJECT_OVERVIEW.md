# Aetheria RPG - 프로젝트 개요서

**작성일:** 2026-02-07  
**버전:** 3.6  
**작성자:** Aetheria Staff Engineer

---

## 1. 프로젝트 소개

### 1.1 개요
Aetheria RPG는 AI 기반 동적 내러티브를 특징으로 하는 **텍스트 기반 로그라이크 RPG 게임**입니다. CLI(명령줄 인터페이스) 스타일의 독특한 UI와 실시간 클라우드 동기화를 통해 어디서든 게임을 이어할 수 있습니다.

### 1.2 핵심 특징
| 특징 | 설명 |
|------|------|
| **AI 동적 내러티브** | Google Gemini 1.5 Flash를 활용한 실시간 이벤트/스토리 생성 |
| **CLI 스타일 UI** | 터미널 기반의 레트로 인터페이스 |
| **클라우드 동기화** | Firebase를 통한 실시간 세이브/로드 |
| **로그라이크 시스템** | 사망 시 무덤 시스템, 퍼마데스 요소 |
| **직업 트리** | 3단계 전직 시스템 (10개 직업) |

---

## 2. 기술 스택

### 2.1 프론트엔드
| 기술 | 버전 | 용도 |
|------|------|------|
| React | 19.2.0 | UI 컴포넌트 프레임워크 |
| Vite | 7.2.4 | 빌드 도구 및 개발 서버 |
| TailwindCSS | 3.4.17 | 유틸리티 기반 CSS |
| Lucide React | 0.563.0 | 아이콘 라이브러리 |
| Chart.js | 4.5.1 | 차트/그래프 시각화 |

### 2.2 백엔드/인프라
| 기술 | 용도 |
|------|------|
| **Firebase Auth** | 익명 인증 |
| **Firestore** | NoSQL 데이터베이스 (게임 저장) |
| **Vercel Functions** | AI Proxy 서버리스 함수 |
| **AWS Lambda** | 백업 AI Proxy 및 분석 |
| **AWS API Gateway** | Lambda 엔드포인트 관리 |

### 2.3 AI 서비스
| 기술 | 모델 | 용도 |
|------|------|------|
| Google Gemini | 1.5 Flash | 이벤트/스토리 생성 |

---

## 3. 프로젝트 구조

```
aetheria-rpg/
├── src/
│   ├── components/          # React UI 컴포넌트
│   │   ├── AdminDashboard.jsx   # 관리자 대시보드
│   │   ├── ControlPanel.jsx     # 게임 조작 패널
│   │   ├── Dashboard.jsx        # 메인 대시보드
│   │   ├── EventPanel.jsx       # 이벤트 표시
│   │   ├── MainLayout.jsx       # 레이아웃
│   │   ├── ShopPanel.jsx        # 상점 UI
│   │   └── TerminalView.jsx     # CLI 터미널 뷰
│   │
│   ├── data/                # 정적 게임 데이터
│   │   ├── classes.js           # 10개 직업 정의
│   │   ├── constants.js         # 게임 상수 (BALANCE)
│   │   ├── items.js             # 아이템 데이터베이스
│   │   ├── maps.js              # 18개 맵 정의
│   │   ├── quests.js            # 퀘스트 데이터
│   │   └── loot.js              # 전리품 테이블
│   │
│   ├── systems/             # 게임 로직 모듈
│   │   ├── CombatEngine.js      # 순수 함수 기반 전투 계산
│   │   ├── TokenQuotaManager.js # AI 일일 사용량 제한
│   │   ├── LatencyTracker.js    # API 응답 시간 추적
│   │   ├── RemoteConfigLoader.js# 원격 설정 로더
│   │   └── FeedbackValidator.js # 피드백 검증
│   │
│   ├── reducers/            # 상태 관리
│   │   └── gameReducer.js       # useReducer 중앙 상태
│   │
│   ├── services/            # 외부 서비스 연동
│   │   └── aiService.js         # Gemini AI 서비스
│   │
│   ├── utils/               # 유틸리티 함수
│   │   ├── commandParser.js     # CLI 명령어 파서
│   │   ├── gameUtils.js         # 게임 헬퍼 함수
│   │   ├── networkUtils.js      # 네트워크 유틸
│   │   └── fileUtils.js         # 파일 유틸
│   │
│   ├── App.jsx              # 메인 앱 (688줄)
│   ├── firebase.js          # Firebase 초기화
│   └── main.jsx             # 엔트리 포인트
│
├── api/                     # Vercel Serverless Functions
│   ├── ai-proxy.js              # Gemini AI 프록시
│   └── feedback-validate.js     # 피드백 검증 API
│
├── aws/                     # AWS 인프라
│   ├── template.yaml            # SAM 템플릿
│   └── lambda/
│       ├── ai-proxy/            # Lambda AI 프록시
│       └── analytics/           # 분석 Lambda
│
└── docs/                    # 문서
    └── Aetheria_Master_Specification.md
```

---

## 4. 핵심 기능

### 4.1 게임플레이 시스템

#### 전투 시스템
- **순수 함수 기반**: `CombatEngine.js`에서 모든 전투 계산 처리
- **공격/스킬/도주**: 다양한 전투 옵션
- **크리티컬 히트**: 10% 기본 확률 (직업별 가변)
- **상태이상**: 화상, 독, 빙결, 기절, 저주 등

#### 직업 시스템
```
Tier 0: 모험가
         ├── Tier 1: 전사 ─── Tier 2: 나이트 / 버서커
         ├── Tier 1: 마법사 ── Tier 2: 아크메이지 / 흑마법사
         └── Tier 1: 도적 ─── Tier 2: 어쌔신 / 레인저
```

#### 맵 시스템
| 지역 | 레벨 범위 | 특징 |
|------|-----------|------|
| 시작의 마을, 고요한 숲, 서쪽 평원 | 1-10 | 초반 지역 |
| 잊혀진 폐허, 어둠의 동굴 | 5-20 | 중반 지역 |
| 화염의 협곡, 용의 둥지 | 15-30 | 화염 지역 (보스) |
| 사막 오아시스, 피라미드 | 15-25 | 사막 지역 (보스) |
| 얼음 성채, 빙하 심연 | 20-35 | 얼음 지역 (보스) |
| 암흑 성, 마왕성 | 30-50 | 최종 지역 (보스) |

### 4.2 AI 내러티브 시스템
- **이벤트 생성**: 탐험 시 AI가 동적 이벤트 생성
- **스토리 생성**: 전투, 레벨업, 사망 등 상황별 내러티브
- **일일 사용량 제한**: 50회/일 (TokenQuotaManager)
- **오프라인 폴백**: AI 불가 시 정적 이벤트 제공

### 4.3 클라우드 동기화
- **익명 인증**: Firebase Anonymous Auth
- **실시간 저장**: Firestore 자동 동기화
- **충돌 방지**: 타임스탬프 기반 동기화 가드
- **리더보드**: 전역 랭킹 시스템

### 4.4 관리자 기능
- **AdminDashboard**: 개발자 전용 대시보드
- **Live-Ops**: 실시간 공지 및 이벤트 배율 조정
- **분석**: Chart.js 기반 통계 시각화

---

## 5. 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────┐
│                           Client (Browser)                          │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────────────────────┐ │
│  │   React UI  │  │  useReducer  │  │       aiService.js          │ │
│  │ (Components)│◄─┤ (gameReducer)│◄─┤ (AI 호출 / 폴백 처리)       │ │
│  └─────────────┘  └──────────────┘  └──────────────┬──────────────┘ │
└────────────────────────────────────────────────────┼────────────────┘
                                                     │
                    ┌────────────────────────────────▼────────────────────────────────┐
                    │                        Vercel Edge                              │
                    │  ┌─────────────────────────────────────────────────────────┐   │
                    │  │                   api/ai-proxy.js                        │   │
                    │  │            (Gemini API Key 서버 사이드 보관)             │   │
                    │  └─────────────────────────────────────────────────────────┘   │
                    └────────────────────────────────┬────────────────────────────────┘
                                                     │
                    ┌────────────────────────────────▼────────────────────────────────┐
                    │                        Google Cloud                             │
                    │  ┌─────────────────────────────────────────────────────────┐   │
                    │  │              Gemini 1.5 Flash API                        │   │
                    │  │         (동적 이벤트 / 스토리 생성)                      │   │
                    │  └─────────────────────────────────────────────────────────┘   │
                    └─────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────────────────────────────────┐
                    │                         Firebase                                │
                    │  ┌───────────────────┐  ┌───────────────────────────────────┐  │
                    │  │  Anonymous Auth   │  │           Firestore               │  │
                    │  │    (인증 관리)    │  │  - users/{uid}: 게임 저장 데이터   │  │
                    │  │                   │  │  - leaderboard: 랭킹 데이터       │  │
                    │  │                   │  │  - config/live: Live-Ops 설정     │  │
                    │  └───────────────────┘  └───────────────────────────────────┘  │
                    └─────────────────────────────────────────────────────────────────┘
```

---

## 6. 게임 상수 (BALANCE)

모든 게임 밸런스 상수는 `src/data/constants.js`에 중앙 집중화:

| 상수 | 값 | 설명 |
|------|-----|------|
| `REST_COST` | 100 | 휴식 비용 (골드) |
| `SKILL_MP_COST` | 10 | 기본 스킬 MP 소모 |
| `CRIT_CHANCE` | 0.1 | 기본 치명타 확률 (10%) |
| `DROP_CHANCE` | 0.4 | 아이템 드랍 확률 (40%) |
| `ESCAPE_CHANCE` | 0.5 | 도주 성공 확률 (50%) |
| `DAILY_AI_LIMIT` | 50 | AI 일일 호출 제한 |
| `EVENT_CHANCE_NOTHING` | 0.3 | 이벤트 없음 확률 (30%) |
| `LOG_MAX_SIZE` | 50 | 최대 로그 개수 |

---

## 7. 보안 설계

### 7.1 API 키 보호
- Gemini API 키는 **서버 사이드에서만** 사용 (Vercel/AWS)
- 클라이언트는 프록시 엔드포인트만 호출

### 7.2 인증
- Firebase Anonymous Auth 사용
- JWT 토큰 기반 API 요청 인증

### 7.3 에러 핸들링
- 모든 AI 호출에 타임아웃 설정 (10-15초)
- AbortController를 통한 요청 취소
- 오프라인 폴백 시스템

---

## 8. 품질 기준

### 8.1 코드 규칙
- 파일당 최대 400줄
- 순수 함수 우선
- 매직 넘버 금지 (BALANCE 상수 사용)
- Single Responsibility 원칙

### 8.2 검증 게이트
1. `npm run build` - 빌드 성공
2. `npm run lint` - ESLint 통과
3. Core flows 수동 테스트 (탐험, 전투, 상점, 휴식)
4. API 에러 핸들링 테스트

---

## 9. 버전 이력

| 버전 | 날짜 | 주요 변경 사항 |
|------|------|----------------|
| 3.6 | 2026-02-04 | 기술 부채 청산, CombatEngine 분리, Hooks 수정, CLI 개선 |
| 3.5 | 2026-01-30 | AWS Lambda 통합, 에러 하드닝 |
| 3.4 | 2026-01-29 | Live-ops 모듈, 관리자 패널 |

---

## 10. 향후 개발 방향

- [ ] 멀티플레이어 던전 레이드
- [ ] 길드 시스템
- [ ] PvP 아레나
- [ ] 모바일 반응형 UI 개선
- [ ] 오프라인 모드 강화

---

**문서 끝**
